---
app_id: cloudflare
app_uuid: e48a0b64-d3ad-436f-95d3-e0c81e6d51d1
assets:
  dashboards:
    Cloudflare-Overview: assets/dashboards/cloudflare_overview.json
  integration:
    auto_install: false
    events:
      creates_events: false
    metrics:
      check: cloudflare.requests.all
      metadata_path: metadata.csv
      prefix: cloudflare
    service_checks:
      metadata_path: assets/service_checks.json
    source_type_id: 215
    source_type_name: Cloudflare
  monitors:
    '[Cloudflare] Abnormal bandwidth being sent for zone': assets/monitors/bandwidth.json
    '[Cloudflare] Error Rate is higher than normal in zone': assets/monitors/error_rate.json
    '[Cloudflare] Error count is unusually high for worker script': assets/monitors/worker_error.json
    '[Cloudflare] High number of detected threats for zone': assets/monitors/threats.json
    '[Cloudflare] Hit Ratio is abnormally low for zone': assets/monitors/hit_ratio.json
author:
  homepage: https://www.datadoghq.com
  name: Datadog
  sales_email: info@datadoghq.com (日本語対応)
  support_email: help@datadoghq.com
categories:
- metrics
- ログの収集
- キャッシュ
- セキュリティ
custom_kind: integration
dependencies: []
display_on_public_website: true
draft: false
git_integration_title: cloudflare
integration_id: cloudflare
integration_title: Cloudflare
integration_version: ''
is_public: true
manifest_version: 2.0.0
name: cloudflare
public_title: Cloudflare
short_description: Monitor your Cloudflare Web traffic, DNS queries, security threats,
  and more.
supported_os: []
tile:
  changelog: CHANGELOG.md
  classifier_tags:
  - Category::Metrics
  - Category::Log Collection
  - Category::Caching
  - Category::Security
  - Offering::Integration
  configuration: README.md#Setup
  description: Monitor your Cloudflare Web traffic, DNS queries, security threats,
    and more.
  media:
  - caption: Cloudflare 概要ダッシュボード
    image_url: images/overview-dashboard.png
    media_type: image
  overview: README.md#Overview
  resources:
  - resource_type: blog
    url: https://www.datadoghq.com/blog/monitor-cloudflare-zero-trust/
  - resource_type: blog
    url: https://www.datadoghq.com/blog/cloudflare-monitoring-datadog/
  support: README.md#Support
  title: Cloudflare
---

<!--  SOURCED FROM https://github.com/DataDog/integrations-internal-core -->
## Overview

Integrate with Cloudflare to get your zone metrics, including web traffic, DNS queries, and threat insights. The integration is based on [Cloudflare's analytics API][1].

**Log Collection**: In addition to these metrics, Cloudflare allows customers to push logs directly into Datadog using Cloudflare Logpush. These detailed logs contain metadata generated by Cloudflare products and are helpful for debugging and creating analytics, especially when combined with logs from other sources. [Enable Cloudflare log collection][2] in combination with these metrics to get full visibility into your Cloudflare environment.

The out-of-the-box dashboard improves the security and performance of your applications. This single pane of glass gives you visibility into

- security threats
- HTTP request volume and error rates
- load balancing, including round-trip time and any changes in traffic flow
- performance issues in worker scripts

With enriched logs and detailed metrics giving you deep insight into your Cloudflare infrastructure, you can build the context you need to resolve issues.

The integration works with [Datadog Cloud SIEM][3] to provide out-of-the-box threat detection for
- impossible travel
- dangerous misconfigurations
- DDoS attacks

Mitigate security threats more quickly with the included Workflow Automation blueprints, such as blocking an IP address or creating a case in Datadog.

## Setup

Before you begin, you need a [Datadog account][4], with an [API key][5], and access to [Cloudflare Logpush][6], which requires an Enterprise account plan. 

When using a Cloudflare API token, ensure it has the **Zone** > **Zone** > **Read** and **Zone** > **Analytics** > **Read** permissions.

### Installation

Install the integration with the Datadog [Cloudflare integration tile][7].

### Configuration

1. Go to the **Configure** tab inside the Datadog [Cloudflare integration tile][7].
2. Enter the email addresses and API keys or token of the accounts you want to monitor. Your Cloudflare API key and API token are available in your Cloudflare account under **My profile** > **Api Tokens**.
3. Add a name for the account. This name is arbitrary and used in the `account` tag on your metrics.

### Log collection

Cloudflare allows customers to push logs directly into Datadog using Cloudflare Logpush. You can manage the Logpush job with the [Cloudflare API](#cloudflare-api) or directly within your [Cloudflare dashboard](#cloudflare-dashboard). 

If you install the Cloudflare integration pipeline, it automatically remaps certain attributes. To see which attributes are remapped:

1. Navigate to [Logs Pipelines][8].
2. Click **Browse Pipeline Library** on the top right.
3. Enter `Cloudflare` in the search bar.
4. Click **Cloudflare** to see the list of remappers and other processors that are installed.

#### Cloudflare API

1. Create a Logpush job by making a POST request to the Logpush jobs endpoint. Include the following fields:
    * `name` (optional): Use your domain name as the job name.
    * `destination_conf`: A log destination consisting of the following parameters:
        * `<DATADOG_ENDPOINT_URL>`: The Datadog HTTP logs intake endpoint, which can be either one below. You can find the difference at [Datadog API reference][9]. 
          * **v1:** `http-intake.logs.{{< region-param key="dd_site" >}}/v1/input`
          * **v2 (latest):** `http-intake.logs.{{< region-param key="dd_site" >}}/api/v2/logs`
        * `<DATADOG_API_KEY>`: Your Datadog API key.
        * `ddsource`: Set to `cloudflare`.
        * `service` (optional): Specify service name.
        * `host` (optional): Specify host name.
        * `ddtags` (optional): Specify tags.
    * `dataset`: The category of logs you want to receive. See the [Cloudflare Log fields][10] for a list of supported datasets.
    * `logpull_options` (optional): To configure fields, sample rate, and timestamp format, see the [Logpush API options][11]. Datadog mandates the use of **RFC 3339 format for timestamps** from Cloudflare, which is the default option used by Cloudflare.

    **Example request**:

    ```bash
    curl -s -X POST 'https://api.cloudflare.com/client/v4/zones/<ZONE_ID>/logpush/jobs' \
    --header 'X-Auth-Key: <CLOUDFLARE_AUTH_KEY>' \
    --header 'X-Auth-Email: <CLOUDFLARE_AUTH_EMAIL>' \
    --header 'Content-Type: application/json' \
    --data-raw '{
       "name": "<NAME>",
       "destination_conf": "datadog://<DATADOG_ENDPOINT_URL>?header_DD-API-KEY=<DATADOG_API_KEY>&ddsource=cloudflare&service=cloudflare&ddtags=env:dev",
       "logpull_options": "fields=RayID,EdgeStartTimestamp&timestamps=rfc3339",
       "dataset": "http_requests"
    }'
    ```

    **Example response**:

    ```bash
    {
     "errors": [],
     "messages": [],
     "result": {
       "id": 100,
       "dataset": "http_requests",
       "enabled": false,
       "name": "<DOMAIN_NAME>",
       "logpull_options": "fields=RayID,EdgeStartTimestamp&timestamps=rfc3339",
       "destination_conf": "datadog://http-intake.logs.{{< region-param key="dd_site" >}}/v1/input?header_DD-API-KEY=<DD-API-KEY>&ddsource=cloudflare&service=cloudflare&ddtags=env:dev",
       "last_complete": null,
       "last_error": null,
       "error_message": null
     },
     "success": true
    }
    ```

    Take note of the value of `id`. In the example above, it is `100`.

2. Enable the job. Use the job ID returned in the response and send `{"enabled": true}` in the request body.

    **Example request**:

    ```bash
    curl -s -X PUT \
    https://api.cloudflare.com/client/v4/zones/<ZONE_ID>/logpush/jobs/<JOB_ID> -d'{"enabled":true}' | jq .
    ```

    **Example response**:

    ```bash
    {
      "errors": [],
      "messages": [],
      "result": {
        "id": 100,
        "dataset": "http_requests",
        "enabled": true,
        "name": "<DOMAIN_NAME>",
        "logpull_options": "fields=RayID,EdgeStartTimestamp&timestamps=rfc3339",
        "destination_conf": "datadog://{{< region-param key="dd_site" >}}?header_DD-API-KEY=<DATADOG-API-KEY>",
        "last_complete": null,
        "last_error": null,
        "error_message": null
      },
      "success": true
    }
    ```

#### Cloudflare dashboard

1. Once you have connected a service with the Logpush section of the Cloudflare dashboard, select the dataset, select data fields, and then, under select destination, choose Datadog.
2. Under **Enter destination information**, enter the Datadog URL Endpoint: 

    ```
    http-intake.logs.{{< region-param key="dd_site" >}}/api/v2/logs?ddsource=cloudflare
    ```
    **Note**: `ddsource=cloudflare` is required. To differentiate between logs, you can also add the optional parameters of `service`, `host`, and `ddtags`.

    **Example**:

    ```
    http-intake.logs.{{< region-param key="dd_site" >}}/api/v2/logs?service=<SERVICE>&host=<HOST>&ddsource=cloudflare
    ```

3. Enter the Datadog API key you used to set-up your Datadog Cloudflare integration tile.
4. After validating access, you should see "Ready to push!" under **Prove ownership**. Click `Push` to complete.

## Data Collected

### Metrics

{{< get-metrics-from-git "cloudflare" >}}

#### Metric categories

The table below describes the types of metrics collected and their associated metric prefixes.

| **Type**          | **Description**                              | **Metric Prefixes Collected**                                                                 |
|-------------------|----------------------------------------------|------------------------------------------------------------------------------------------------|
| **Web Analytics** | Metrics related to web traffic and performance. | `cloudflare.requests.all`<br>`cloudflare.requests.cached`<br>`cloudflare.requests.uncached`<br>`cloudflare.requests.ssl.encrypted`<br>`cloudflare.requests.ssl.unencrypted`<br>`cloudflare.requests.country`<br>`cloudflare.requests.status`<br>`cloudflare.requests.content_type`<br>`cloudflare.requests.ip_class`<br>`cloudflare.bandwidth.all`<br>`cloudflare.bandwidth.cached`<br>`cloudflare.bandwidth.uncached`<br>`cloudflare.bandwidth.ssl.encrypted`<br>`cloudflare.bandwidth.ssl.unencrypted`<br>`cloudflare.bandwidth.country`<br>`cloudflare.bandwidth.content_type`<br>`cloudflare.threats.all`<br>`cloudflare.threats.type`<br>`cloudflare.threats.country`<br>`cloudflare.pageviews.all`<br>`cloudflare.pageviews.search_engine`<br>`cloudflare.uniques.all` |
| **DNS**           | Metrics related to DNS queries and response times. | `cloudflare.dns.query.all`<br>`cloudflare.dns.query.uncached`<br>`cloudflare.dns.query.stale`<br>`cloudflare.dns.response_time.avg`<br>`cloudflare.dns.response_time.median`<br>`cloudflare.dns.response_time.90p`<br>`cloudflare.dns.response_time.99p` |
| **Load Balancer** | Metrics related to load balancing pools.          | `cloudflare.load_balancer.pool.round_trip_time.average`<br>`cloudflare.load_balancer.pool.health.status` |
| **Worker Script** | Metrics related to Cloudflare Workers scripts.     | `cloudflare.workers.requests.all`<br>`cloudflare.workers.requests.errors`<br>`cloudflare.workers.requests.subrequests`<br>`cloudflare.workers.response_time.75p`<br>`cloudflare.workers.response_time.99p`|

#### Permissions
Verify your Cloudflare API token has these permissions enabled:

| Scope       | Permission         |   Status    |
| ----------- | ------------------ | ----------- |
| Account     | Account Analytics  |    Read     |
| Account     | Account Setting    |    Read     |
| Account     | Worker Scripts     |    Read     |
| Zone        | Zone               |    Read     |
| Zone        | Analytics          |    Read     |
| Zone        | Worker Routes      |    Read     |
| Zone        | Load Balancers     |    Read     |

### Events

The Cloudflare integration does not include any events.

### Service Checks

The Cloudflare integration does not include any service checks.

## Troubleshooting

Need help? Contact [Datadog support][12].

[1]: https://developers.cloudflare.com/analytics/graphql-api/
[2]: https://docs.datadoghq.com/ja/integrations/cloudflare/#log-collection
[3]: https://docs.datadoghq.com/ja/security/cloud_siem/
[4]: https://www.datadoghq.com/free-datadog-trial/
[5]: /ja/account_management/api-app-keys/#api-keys
[6]: https://developers.cloudflare.com/logs/about
[7]: https://app.datadoghq.com/integrations/cloudflare
[8]: https://app.datadoghq.com/logs/pipelines
[9]: https://docs.datadoghq.com/ja/api/latest/logs/
[10]: https://developers.cloudflare.com/logs/log-fields
[11]: https://developers.cloudflare.com/logs/logpush/logpush-configuration-api/understanding-logpush-api#options
[12]: https://docs.datadoghq.com/ja/help/